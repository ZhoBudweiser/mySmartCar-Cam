//
// Created by wcjzj on 2017/5/23.
//
#include "headfile.h"
#include "bpnn_fit.h"
#include <math.h>

struct bpnn nn;
double v[D][Q] = {
//	{-38.568356, -20.055954, -28.250022},
//	{30.499024, -5.816888, 1.388523},
//	{-50.894490, -19.961592, -22.057308},
//	{-26.121471, -8.004382, -9.153486},
//	{-44.744739, -20.427682, -23.237678},
//	{4.894644, -7.289755, -4.091436},
//	{-2.519284, 11.846472, 111.290638},
//	{-49.269629, -1.966269, -13.694338},
//	{131.516883, 6.443683, 2.735891},
//	{-122.189813, -15.134259, -33.406205},
//	{147.960512, 5.048543, 66.337368},
	
	{20.865354, -20.598455, -41.577853},
	{121.065126, -6.339286, 36.686112},
	{-46.583925, -20.967951, -48.179362},
	{-41.340273, -9.868342, -99.182647},
	{0.989327, -21.163716, -35.269077},
	{50.984002, -8.415533, -37.639700},
	{108.820287, 6.577890, 52.587444},
	{-196.621040, -4.941183, -128.096873},
	{2.405237, -4.711104, 154.806746},
	{-115.759517, -16.642719, -22.695588},
	{105.762571, -0.717507, 211.348148},
};
double w[Q][L] = {
//	{3.916971},
//	{3.953862},
//	{4.489746},
	{6.945892},
	{3.935254},
	{9.533074},
};
double r[Q] = {
//	14.516679, 1.580178, 4.460604
	34.009677, 1.676771, 25.140380
};
double b[Q] = {
	0, 0, 0
};

T bpnn_fit_new(void) {
    T bpnn;

    bpnn = &nn;
		bpnn->r = r;
//		bpnn->o = 3.784295;
		bpnn->o = 12.89050;
		bpnn->b = b;
		bpnn->v = &v[0];
		bpnn->w = &w[0];
		
	return bpnn;
}

double bpnn_fit(T bpnn, double *in) {
	
    for (uint8 h = 0; h < Q; h++) {
        double alpha_h = 0;
        for (uint8 i = 0; i < D; i++)
            alpha_h += bpnn->v[i][h] * in[i];
        bpnn->b[h] = ACTIVATION_FUNC(alpha_h - bpnn->r[h]);
    }

		double beta_j = 0;
		for (uint8 h = 0; h < Q; h++)
				beta_j += bpnn->w[h][0] * bpnn->b[h];
		return ACTIVATION_FUNC(beta_j - bpnn->o);
		
}
